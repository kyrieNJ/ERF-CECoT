# ERF-CECoT
Code for our paper:
An Empathetic Response Generation Framework Based on the Cognitive-Emotion Chain-of-Thought

## Requirements
* Python 3.10.18
* langchain 0.3.27
* torch 2.7.1
* SpaCy 3.7.5
* numpy 1.26.4
* scikit-learn 1.7.0
* sentencepiece 0.2.0
* transformers 4.45.1
* zh-core-web-sm 3.7.0
* jieba 0.42.1

## Train stage
* You can train the model for cognitive distortion detector, run the code [train4cd.py](./ERF-CECoT/pretrain/train4cd.py).
```bash
python ./pretrain/train4cd.py 
```
* You can train the model for emotion detector, run the code [train4emo.py](./ERF-CECoT/pretrain/train4emo.py).
```bash
python ./pretrain/train4emo.py 
```
* You can also use the trained model to infer the results for the given data, run the code [infer4cdemo.py](./ERF-CECoT/pretrain/infer4cdemo.py).
```bash
python ./pretrain/infer4cdemo.py 
```

## Citation
If our work has been helpful to you, please mark references to our work in your research and thank you for your support.

## Details of emotion label reclassification.
<img width="783" height="351" alt="image" src="https://github.com/user-attachments/assets/4c43554c-669e-4286-a614-04ca61266b2e" />

## Detailed instructions for labeling
For annotation of the C2D2-EMO dataset, we employed DeepSeek as the annotation model. The prompt used during annotation is shown below. For data verification, we assembled an annotation expert team comprising one attending psychiatrist and two master's degree students in relevant fields (all members completed specialized training and passed consistency testing). We strictly adhered to the definitions of the emotion classification system proposed by Ekman. During the decision-making process, when the annotations of the three experts diverged, the case was submitted to the psychiatrist for arbitration. The final annotation was determined through internal team discussion. To ensure internal consistency, we randomly selected 10\% of the samples for re-annotation by the entire team to calculate the Kappa coefficient. If the coefficient was low, the team discussed and updated the annotation standards.
<img width="627" height="932" alt="image" src="https://github.com/user-attachments/assets/e44db537-4ed6-46ac-8f6f-3fcdae14697a" />

## Analysis of Few-shot Examples
To analyze the impact of varying few-shot sample sizes on model performance, we selected six distinct samples from the test set and conducted experiments by incrementally increasing the number of samples. Here, we employed Llama3 as the baseline model. For Llama3, we directly added the standard answer to the sample responses. For ERF-CECoT, we additionally constructed corresponding prompts based on the cognition-emotion chain-of-thought for each sample. (Detailed content of these few-shot examples is shown in the project's GitHub repository.) To better evaluate model performance, we adopted Rouge-L alongside Dist-1 and Dist-2 metrics to assess the consistency of generated responses. Experimental results are shown in Figure 1. Here, “0” denotes zero-shot.

From Figure 1, we can observe that as the number of few-shot samples increases, Llama3 exhibits a significant overall decline in performance. Although both Dist-1 and Dist-2 values show an increase when the few-shot sample count is 6, they remain substantially lower than the optimal performance values. In contrast, ERF-CECoT exhibits a smaller overall decline in performance, particularly showing Dist-1 and Dist-2 metrics that are noticeably higher than zero-shot levels. We analyze that this may be because: an excessive number of few-shot samples causes Llama3 to learn fixed response patterns from these samples, leading to uniformly generated empathetic responses when addressing other seekers' input content. Conversely, ERF-CECoT leveraged a few-shot samples to learn insights about the seeker's cognitive state and emotion, as well as response logic based on chain-of-thought reasoning. This enables ERF-CECoT to generate responses that combine empathy with clinical logic across diverse scenarios, validating the robustness of our proposed ERF-CECoT framework.
<img width="1337" height="368" alt="image" src="https://github.com/user-attachments/assets/bd26d933-ceef-4644-b164-bec2e7b318c0" />
Figure 1. Performance comparison between Llama3 and ERF-CECoT under different numbers of few-shot examples.

### Table 1. Detailed information on few-shot samples

| Few-shot samples | Llama3 | ERF-CECoT |
|------------------|--------|-----------|
| 1 | Dialogue history: Input of the seeker:"Today, as I was leaving for work in the morning, I had a tire burst in the middle of a busy road. That scared the hell out of me!". Final response: Are you fine now? | Dialogue history: Emotional analysis of last turn's dialogue: This is the first turn of dialogue. Input of the seeker:"Today, as I was leaving for work in the morning, I had a tire burst in the middle of a busy road. That scared the hell out of me!". Input analysis: Currently, seeker's cognition of this input is not distorted, but the seeker experienced a feeling of moderate fear. Constraints for response objective: The current seeker's emotional intensity is within normal range. Your objective is to respond with an emotional intensity roughly equivalent to his/her own, maintaining empathy and a sense of being understood while incorporating appropriate exploration and guidance. Thinking Process: Step 1: Analyze dialogue history. Since this is the first turn of dialogue, there is no need to analyze past logic; skip this step directly. Step 2: Understand the semantic meaning of the seeker's input and analyze his/her current cognitive and emotion. The seeker input describes a specific event: a tire blowout occurred on a busy road during the morning commute, causing the seeker to feel intense fear. Semantically, the event itself is characterized by suddenness and danger(the blowout occurred on a busy road). The seeker's cognition is not distorted and can objectively describe the event. However, emotionally, they experienced "moderate fear," which is directly related to the event's potential risks(e.g., safety incidents). The causal relationship is clear: the tire blowout, as an external stimulus, triggered the seeker's fear-a reasonable stress response. Step 3: Define the response objective. Given the constraint that the seeker's emotional intensity is moderate fear, the response must maintain equivalent emotional intensity, avoiding excessive exaggeration or downplaying.The core objective should be care. Step 4: Generate an empathetic response. Based on the preceding analysis, the response should gently inquire about the current safety status while demonstrating concern for the subsequent situation. Final response: Are you fine now? |
| 2 | Dialogue history: seeker:"Today, as I was leaving for work in the morning, I had a tire burst in the middle of a busy road. That scared the hell out of me!" supporter:"Are you fine now?" Input of the seeker:"Yeah, I'm doing alright now, but with minor injuries.". Final response: Cool:) Is your car damaged a lot? | Dialogue history: seeker:"Today, as I was leaving for work in the morning, I had a tire burst in the middle of a busy road. That scared the hell out of me!" supporter:"Are you fine now?" Emotional analysis of last turn's dialogue: In the last conversation, the seeker felt fear. Input of the seeker:"Yeah, I'm doing alright now, but with minor injuries." Input analysis: Currently, the seeker's cognition of this input is not distorted, and no emotions have been generated. Constraints for response objective: The current seeker's emotional intensity is within normal range. Your objective is to respond with an emotional intensity roughly equivalent to his/her own, maintaining empathy and a sense of being understood while incorporating appropriate exploration and guidance. Thinking Process: Step 1: Analyze dialogue history. In the dialogue history, the seeker described the terrifying experience of a tire blowout and expressed feelings of fear. The supporter responded with concern, asking if the seeker was okay. This indicates the dialogue logic: the seeker shares a traumatic event, and the supporter provides emotional support while checking on the seeker's current state. Step 2: Understand the semantic meaning of the seeker's input and analyze his/her current cognitive and emotion. The seeker's current input,"Yeah, I'm doing alright now, but with minor injuries," semantically indicates recovery from fear with a generally stable condition, though accompanied by minor injuries. Cognitively, the seeker objectively assesses their situation without distortion. Emotionally, intensity is normal, trending toward calm with no significant fluctuations. Step 3: Define the response objective. The response goal is: to respond with an emotional intensity matching the seeker's current state(calm), demonstrating empathy and understanding while gently probing injury details without excessive intervention. Step 4: Generate an empathetic response. Based on the above, the response should first acknowledge the seeker's recovery. Logically building on the dialogue history, it should focus on the seeker's current situation. Final response: Cool:) Is your car damaged a lot? |
| 3 | Dialogue history: Input of the seeker:"A few weeks ago, I was walking through my hallway, minding my own business, when all of a sudden a hand reached out from under a table and grabbed my weeks ago, I was walking thought I was got. Turns out, it was my son." Final response: That's funny, hope he didn't give you a heart attack. | Dialogue history: Emotional analysis of last turn's dialogue: This is the first turn of dialogue. Input of the seeker:"A few weeks ago, I was walking through my hallway, minding my own business, when all of a sudden a hand reached out from under a table and grabbed my ankle. I was so surprised. I thought I was got. Turns out, it was my son.". Input analysis: Currently, seeker's cognition of this input is not distorted, but the seeker experienced a feeling of moderate joy. Constraints for response objective: The current seeker's emotional intensity is within normal range. Your objective is to respond with an emotional intensity roughly equivalent to his/her own, maintaining empathy and a sense of being understood while incorporating appropriate exploration and guidance. Thinking Process: Step 1: Analyze dialogue history. Since this is the first turn of dialogue, skip this step. Step 2: Understand the semantic meaning of the seeker's input and analyze his/her current cognitive and emotion. The seeker describes an event from several weeks ago: While walking down a hallway, a hand suddenly grabbed his ankle from beneath a table. Initially startled and fearing danger, he relaxed upon realizing it was his son's prank. Semantically, this is a personal narrative shifting from fright to humor, highlighting the playful nature of family interactions. Cognitively, the seeker narrates objectively without distortion, demonstrating rational perspective. Emotionally, the seeker experienced moderate joy stemming from the unexpected delight and familial warmth of the outcome. The causal chain is: the surprise triggered initial shock, which transformed into joy upon revealing the son's identity. Step 3: Define the response objective. Given the seeker's current emotional intensity (moderate joy, within normal range), the response goal is: to reply with comparable emotional intensity(lighthearted, joyful) while expressing empathy and understanding, making the seeker feel accepted. Simultaneously, incorporate gentle guidance(e.g., encouraging sharing more family anecdotes to reinforce positive emotions), avoiding excessive intervention to maintain natural conversation flow. Step 4: Generate an empathetic response. Using the above information, formulate a response plan: Begin with resonance, acknowledging the seeker's joy(e.g., expressing amusement or relief), then explore the event through questions(e.g., about the son's reaction or the seeker's subsequent feelings). Logically, the response must be coherent, transitioning from understanding to exploration, ensuring alignment with the seeker's emotional state. Final response: That's funny, hope he didn't give you a heart attack. |
| 4 | Dialogue history: seeker:"A few weeks ago, I was walking through my hallway, minding my own business, when all of a sudden a hand reached out from under a table and grabbed my ankle. I was so surprised. I thought I was got. Turns out, it was my son." supporter:"That's funny, hope he didn't give you a heart attack." Input of the seeker:"I may have let out a scream that will have him question my manhood for the rest of our lives, lol.". Final response: I would probably scream also. | Dialogue history: seeker:"A few weeks ago, I was walking through my hallway, minding my own business, when all of a sudden a hand reached out from under a table and grabbed my ankle. I was so surprised. I thought I was got. Turns out, it was my son." supporter:"That's funny, hope he didn't give you a heart attack." Emotional analysis of last turn's dialogue: In the last conversation, the seeker felt fear. Input of the seeker:"I may have let out a scream that will have him question my manhood for the rest of our lives, lol.". Input analysis: Currently, the seeker's cognitive distortion type is fortune-telling regarding this input, thus making the seeker feel mild fear. Constraints for response objective: The current seeker's emotional intensity is within normal range. Your objective is to respond with an emotional intensity roughly equivalent to his/her own, maintaining empathy and a sense of being understood while incorporating appropriate exploration and guidance. Follow the provided thinking process step by step to formulate your response: Thinking Process: Step 1: Analyze dialogue history. Analyze the logic of past dialogues. Skip this step for the initial dialogue. Step 2: Understand the semantic meaning of the seeker's input and analyze his/her current cognitive and emotion. Grasp the main content of the seeker's current input and the causal relationship between the seeker's cognition and emotion. Step 3: Define the response objective. Determine your response goal-such as inquiring about the situation, alleviating anxiety, offering comfort, or expressing understanding. Step 4: Generate an empathetic response. Develop a response plan using the above information, ensuring its logic aligns with preceding steps. The output should focus solely on delivering a thoughtful and empathetic reply. Final response: I would probably scream also. |
| 5 | Dialogue history: seeker:"I'm overly excited because will be flying outside the country for the first time tomorrow.". Please enter here..." supporter:"Wow! That sounds amazing. Where are you going? Input of the seeker:"Traveling to South Africa then to Ghana. Also my first time visiting Africa" Final response: You are going to love it I am sure. Safe Travels! | Dialogue history: seeker:"I'm overly excited because will be flying outside the country for the first time tomorrow.". Please enter here..." supporter:"Wow! That sounds amazing. Where are you going?" Emotional analysis of last turn's dialogue: In the last conversation, the seeker felt joy Input of the seeker:"Traveling to South Africa then to Ghana. Also my first time visiting Africa" Input analysis: Currently, seeker's cognition of this input is not distorted, but the seeker experienced a feeling of joy. Constraints for response objective: The current seeker's emotional intensity is too low. Your goal is to activate emotions. Please generate more emotional and exploratory language to moderately amplify and evoke emotions. Note: Moderately enrich vocabulary and metaphors, ask open-ended questions, guide toward refinement, use slightly longer sentences, and provide space for exploration Follow the provided thinking process step by step to formulate your response: Thinking Process: Step 1: Analyze dialogue history. Analyze the logic of past dialogues. Skip this step for the initial dialogue. Step 2: Understand the semantic meaning of the seeker's input and analyze his/her current cognitive and emotion. Grasp the main content of the seeker's current input and the causal relationship between the seeker's cognition and emotion. Step 3: Define the response objective. Determine your response goal-such as inquiring about the situation, alleviating anxiety, offering comfort, or expressing understanding. Step 4: Generate an empathetic response. Develop a response plan using the above information, ensuring its logic aligns with preceding steps. The output should focus solely on delivering a thoughtful and empathetic reply. Note: The generated response should not exceed 10 words. Don't include your thinking process-just output your response directly. When the seeker asks you a question, you should answer it directly. Final response: You are going to love it I am sure. Safe Travels! |
| 6 | Dialogue history: seeker:"One time, I was holding my son over my head, when all of a sudden, he threw up all over my face. I almost cried." supporter:"That's horrible, hope he is ok." Input of the seeker:"yeah, he had just drank a bottle, and I was moving him around like an airplane. In retrospect. I deserved it.". Final response: I see, glad he is ok. | Dialogue history: seeker:"One time, I was holding my son over my head, when all of a sudden, he threw up all over my face. I almost cried." supporter:"That's horrible, hope he is ok." Emotional analysis of last turn's dialogue: In the last conversation, the seeker felt sadness. Input of the seeker:"yeah, he had just drank a bottle, and I was moving him around like an airplane. In retrospect. I deserved it.". Input analysis: Currently, seeker's cognition of this input is not distorted, but the seeker experienced a feeling of severe sadness. Constraints for response objective: The current seeker's emotional intensity is within normal range. Your objective is to respond with an emotional intensity roughly equivalent to his/her own, maintaining empathy and a sense of being understood while incorporating appropriate exploration and guidance. Follow the provided thinking process step by step to formulate your response: Thinking Process: Step 1: Analyze dialogue history. Analyze the logic of past dialogues. Skip this step for the initial dialogue. Step 2: Understand the semantic meaning of the seeker's input and analyze his/her current cognitive and emotion. Grasp the main content of the seeker's current input and the causal relationship between the seeker's cognition and emotion. Step 3: Define the response objective. Determine your response goal-such as inquiring about the situation, alleviating anxiety, offering comfort, or expressing understanding. Step 4: Generate an empathetic response. Develop a response plan using the above information, ensuring its logic aligns with preceding steps. The output should focus solely on delivering a thoughtful and empathetic reply. Final response: I see, glad he is ok. |
